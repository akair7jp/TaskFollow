<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>ã‚¿ã‚¹ã‚¯ç®¡ç† - TaskFollow</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        :root { --p: #5b50f2; --bg: #f8f9fc; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); margin: 0; color: #333; }
        
        /* ãƒ˜ãƒƒãƒ€ãƒ¼ */
        header { background: white; padding: 12px 60px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; }
        .h-btn { padding: 9px 18px; border-radius: 0.75rem; border: 1px solid #e5e7eb; background: white; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 8px; font-size: 14px; font-family: inherit; }
        .h-btn-main { background: var(--p); color: white; border: none; padding: 11px 22px; }

        /* æŒ‡å®š: æ¤œç´¢ãƒãƒ¼ã®ãƒ‡ã‚¶ã‚¤ãƒ³ [ã‚½ãƒ¼ã‚¹ 44, 46, 48] */
        .search-container { padding: 0 60px 20px; position: relative; }
        .search-container i { position: absolute; left: 80px; top: 14px; color: #cbd5e0; }
        #task-search { 
            width: 100%; padding: 12px 12px 12px 45px; border: 1px solid #eee; 
            border-radius: 0.75rem; background: white; font-family: inherit; font-size: 14px;
            box-sizing: border-box;
        }

        /* ã‚¿ã‚¹ã‚¯ã‚«ãƒ¼ãƒ‰ */
        .task-card { background: white; padding: 25px 30px; border-radius: 1.5rem; border: 1px solid #eee; margin: 0 60px 15px; }
        .st-btn { padding: 8px 22px; border-radius: 20px; border: 1px solid #eee; background: white; font-size: 13px; font-weight: 600; cursor: pointer; color: #999; margin-right: 10px; font-family: inherit; }
        .st-btn.active { background: var(--p); color: white; border-color: var(--p); }

        .hidden { display: none; }
    </style>
</head>
<body>
    <header>
        <div>
            <h2 style="margin:0; font-size:22px;">ã‚¿ã‚¹ã‚¯ç®¡ç†</h2>
            <div style="font-weight:700;"><span id="u-name">...</span> ã•ã‚“</div>
        </div>
        <div style="display:flex; gap:12px;">
            <button class="h-btn"><i class="fa-solid fa-gear"></i> è¨­å®š</button>
            <button class="h-btn"><i class="fa-solid fa-file-import"></i> ã‚¤ãƒ³ãƒãƒ¼ãƒˆ</button>
            <button class="h-btn-main h-btn"><i class="fa-solid fa-plus"></i> æ–°è¦ã‚¿ã‚¹ã‚¯</button>
        </div>
    </header>

    <!-- æ¤œç´¢ãƒãƒ¼ã®å¾©å…ƒ [ã‚½ãƒ¼ã‚¹ 46, 51] -->
    <div class="search-container">
        <i class="fa-solid fa-magnifying-glass"></i>
        <input type="text" id="task-search" placeholder="ã‚¿ã‚¹ã‚¯ã‚’æ¤œç´¢..." oninput="filterTasks()">
    </div>

    <div id="task-list"></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js";
        import { getFirestore, collection, query, where, onSnapshot } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

        const db = getFirestore(initializeApp({ apiKey: "AIzaSyBV5WcWYSBUybd-Jv6iUnC80QNFAjMc5VU", authDomain: "taskfollow-b70ff.firebaseapp.com", projectId: "taskfollow-b70ff" }));
        const auth = getAuth();
        let allTasks = []; // æ¤œç´¢ç”¨ã«å–å¾—æ¸ˆã¿ãƒ‡ãƒ¼ã‚¿ã‚’ä¿æŒ

        onAuthStateChanged(auth, (u) => {
            if (!u) window.location.href = "index.html";
            document.getElementById('u-name').innerText = u.displayName || "ãƒ¦ãƒ¼ã‚¶ãƒ¼";
            loadTasks(u.uid);
        });

        // ã‚¿ã‚¹ã‚¯ã®èª­ã¿è¾¼ã¿ã¨ä¿æŒ
        function loadTasks(uid) {
            const q = query(collection(db, "tasks"), where("uid", "==", uid));
            onSnapshot(q, (snap) => {
                allTasks = [];
                snap.forEach(d => allTasks.push({ id: d.id, ...d.data() }));
                renderTasks(allTasks);
            });
        }

        // ä¿®æ­£: æ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ãƒ­ã‚¸ãƒƒã‚¯
        window.filterTasks = () => {
            const keyword = document.getElementById('task-search').value.toLowerCase();
            const filtered = allTasks.filter(t => 
                t.title.toLowerCase().includes(keyword) || 
                (t.category && t.category.toLowerCase().includes(keyword))
            );
            renderTasks(filtered);
        };

        // ã‚¿ã‚¹ã‚¯ä¸€è¦§ã®æç”»
        function renderTasks(tasks) {
            const container = document.getElementById('task-list');
            if (tasks.length === 0) {
                container.innerHTML = '<p style="text-align:center; color:#888; margin-top:40px;">ã‚¿ã‚¹ã‚¯ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ [4, 5]</p>';
                return;
            }
            container.innerHTML = "";
            tasks.forEach(t => {
                container.innerHTML += `
                    <div class="task-card">
                        <h3 style="margin:0 0 15px;"><input type="checkbox"> ${t.title}</h3>
                        <div style="margin-bottom:20px; font-size:13px; color:#888; display:flex; gap:20px;">
                            <span><i class="fa-solid fa-flag" style="color:#ff4d4d; margin-right:5px;"></i>${t.priority || 'ä¸­'}</span>
                            <span style="background:#f0efff; color:var(--p); padding:3px 10px; border-radius:6px; font-weight:700;">${t.category || 'ãªã—'}</span>
                            <span>ğŸ•’ ${t.date || 'æœŸé™ãªã—'}</span>
                        </div>
                        <button class="st-btn ${t.status=='æœªç€æ‰‹'?'active':''}">æœªç€æ‰‹</button>
                        <button class="st-btn ${t.status=='é€²è¡Œä¸­'?'active':''}">é€²è¡Œä¸­</button>
                        <button class="st-btn ${t.status=='å®Œäº†'?'active':''}">å®Œäº†</button>
                    </div>`;
            });
        }
    </script>
</body>
</html>
